<Page
    x:Class="YingCaiAiWin.Views.Pages.AIWindows"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:local="clr-namespace:YingCaiAiWin.Views.Pages"
     xmlns:hc="https://handyorg.github.io/handycontrol"
      xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance local:AIWindows,
                                     IsDesignTimeCreatable=False}"
     d:DesignHeight="800"
     d:DesignWidth="1000"
    Title="客户服务系统" 
  >
    <!--WindowStartupLocation="CenterScreen"
    ExtendsContentIntoTitleBar="True"
    WindowCornerPreference="Round"
    WindowBackdropType="Mica"-->

    <Grid x:Name="Gridwin" Height="800">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="400" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <!-- 左侧内置浏览器 -->
        <ui:Card Grid.Column="0" >
            <TabControl x:Name="MainTabControl" FontSize="14">
                <!-- 浏览器页 -->
                <TabItem Header="浏览器">
                    <Grid MinHeight="725">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="65"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- 浏览器导航栏 -->
                        <ui:Card Grid.Row="0" Height="65"  >
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- 控制按钮 -->
                                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,5,0">
                                    <ui:Button Appearance="Secondary" ToolTip="后退" Margin="0,0,2,0" Click="BackButton_Click">
                                        <ui:SymbolIcon Symbol="ArrowLeft24" />
                                    </ui:Button>
                                    <ui:Button Appearance="Secondary" ToolTip="前进" Margin="0,0,2,0" Click="ForwardButton_Click">
                                        <ui:SymbolIcon Symbol="ArrowRight24" />
                                    </ui:Button>
                                    <ui:Button Appearance="Secondary" ToolTip="刷新" Margin="0,0,2,0" Click="RefreshButton_Click">
                                        <ui:SymbolIcon Symbol="ArrowReset24" />
                                    </ui:Button>
                                    <ui:Button Appearance="Secondary" ToolTip="主页" Click="HomeButton_Click">
                                        <ui:SymbolIcon Symbol="Home24" />
                                    </ui:Button>
                                </StackPanel>

                                <!-- 地址栏 -->
                                <ui:TextBox Grid.Column="1" x:Name="AddressBar" PlaceholderText="输入网址..." Margin="5,0" KeyDown="AddressBar_KeyDown"/>

                                <!-- 跳转 -->
                                <ui:Button Grid.Column="2" Appearance="Primary" ToolTip="转到" Click="GoButton_Click">
                                    <ui:SymbolIcon Symbol="ArrowRight24" />
                                </ui:Button>
                            </Grid>
                        </ui:Card>

                        <!-- 浏览器 -->
                        <Border Grid.Row="1"  ClipToBounds="True">
                            <wv2:WebView2 x:Name="EmbeddedBrowser"
                                  NavigationCompleted="EmbeddedBrowser_NavigationCompleted"
                                  Source="https://www.baidu.com/"
                                   />
                        </Border>
                    </Grid>
                </TabItem>

                <!-- 自定义卡片内容页 -->
                <TabItem Header="卡片内容" >
                    <Grid Height="725">
                        <ScrollViewer  VerticalScrollBarVisibility="Hidden" Height="725" >

                            <ItemsControl ItemsSource="{Binding  ViewModel.CardItems}" >
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <!--<UniformGrid Rows="1" Columns="3" />-->
                                        <WrapPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>

                                        <ui:CardAction
                      Margin="10"
                      Padding="0"
                      VerticalAlignment="Stretch"
                     Background="{Binding IconPath}"
                     MaxHeight="210"
                     Width="305"
                      IsChevronVisible="False">

                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="30" />
                                                </Grid.ColumnDefinitions>
                                                <!-- 关闭按钮 -->

                                                <StackPanel Grid.Column="0" Margin="10"  VerticalAlignment="Center" MaxHeight="200">
                                                    <TextBlock
                             FontWeight="SemiBold"
                             FontSize="16"
                             Text="{Binding Title}"
                             TextTrimming="CharacterEllipsis"
                             TextWrapping="NoWrap"
                             ToolTip="{Binding Title}" />
                                                    <ScrollViewer VerticalScrollBarVisibility="Hidden" MaxHeight="170" >
                                                        <TextBox
                             Text="{Binding Description}"
                             TextWrapping="Wrap"
                             Background="Transparent"
                             BorderThickness="0"
                             IsReadOnly="True"
                             IsReadOnlyCaretVisible="False"
                             VerticalScrollBarVisibility="Auto"
                             FontSize="14"
                             Foreground="{DynamicResource  DarkPrimaryBrush}" />
                                                    </ScrollViewer>
                                                </StackPanel>
                                                <Button Content="✕" Grid.Column="2"
                            
                              Height="35"
                              FontSize="35"
                              FontWeight="Bold"
                              VerticalAlignment="Top"
                              HorizontalAlignment="Right"
                              BorderBrush="{x:Null}"
                              Background="Transparent"                              
                              ToolTip="关闭卡片"
                              Cursor="Hand"
                             Command="{Binding ViewModel.CloseCardCommand,  RelativeSource={RelativeSource AncestorType=local:AIWindows}}"
                             CommandParameter="{Binding CommandParam}"
    
                              />
                                            </Grid>
                                        </ui:CardAction>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                        </ScrollViewer>
                    </Grid>
                   
                </TabItem>
            </TabControl>
        </ui:Card>
        <!-- 右侧客服界面 -->
        <Grid x:Name="kefuH" Grid.Column="1" Background="{ui:ThemeResource ApplicationBackgroundBrush}" MinHeight="800"  >
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 顶部蓝色标题栏 -->
            <ui:Card Grid.Row="0" Background="#4285F4" Margin="10,10,10,5" Padding="15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <ui:SymbolIcon Symbol="Bot24" Foreground="White" FontSize="24" />
                        <TextBlock Text="请问有什么可以帮助你?" Foreground="White" FontSize="16" VerticalAlignment="Center" Margin="10,0,0,0" />
                    </StackPanel>


                </Grid>
            </ui:Card>

            <!-- 当前客户信息 -->
            <ui:Card Grid.Row="1" Background="#F5F5F5" Margin="10,0,10,5" Padding="5" Height="40">
                <TextBlock Text="{Binding ViewModel.CusName}" 
                           FontSize="14" 
                           FontWeight="SemiBold"
                           VerticalAlignment="Center" />
            </ui:Card>


            <!-- 主要内容区域 -->
            <ui:Card Grid.Row="2" x:Name="newsPanel" Height="590" Margin="10,0,0,5"  >
                <StackPanel>

                    <Expander  x:Name="expander"  Header="自助工具"  FontWeight="SemiBold" Margin="10,0,10,10" >

                        <Border Height="auto" BorderThickness="1,0,1,1" BorderBrush="{DynamicResource BorderBrush}" Background="{DynamicResource RegionBrush}" CornerRadius="0,0,4,4" >

                            <ui:Card  Padding="10">
                                <ItemsControl ItemsSource="{Binding ViewModel.ToolItems}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <UniformGrid Columns="4" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <ui:Card Margin="5" Padding="10" Background="#F0F5FF"  MouseLeftButtonUp="Tool_Click"   VerticalAlignment="Center" HorizontalAlignment="Center"   >

                                                <StackPanel HorizontalAlignment="Center">

                                                    <ui:SymbolIcon Symbol="{Binding Icon}" Foreground="#4285F4" HorizontalAlignment="Center" />
                                                    <TextBlock Text="{Binding Title}" FontSize="12" HorizontalAlignment="Center" Margin="0,5,0,0" />
                                                </StackPanel>

                                            </ui:Card>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ui:Card>


                        </Border>
                    </Expander>


                    <ScrollViewer x:Name="newScroll" VerticalScrollBarVisibility="Auto" Margin="10,0,10,5" Height="530" >
                        <StackPanel x:Name="newStackPanel">
                            <!-- 猜你想问区域 -->
                            <ui:Card Padding="15"  >
                                <StackPanel>
                                    <Grid Margin="0,0,0,10">
                                        <TextBlock Text="猜你想问" FontSize="16" FontWeight="SemiBold" />
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Cursor="Hand" MouseDown="RefreshQuestions_Click">
                                            <ui:SymbolIcon Symbol="ArrowSync24" Foreground="#4285F4" />
                                            <TextBlock Text="换一批" Foreground="#4285F4" Margin="5,0,0,0" />
                                        </StackPanel>
                                    </Grid>

                                    <ItemsControl x:Name="QuestionsList">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <ui:CardAction Padding="12" Margin="0,0,0,10" Click="Question_Click" Tag="{Binding}" >
                                                    <Grid  >
                                                        <StackPanel Orientation="Horizontal">
                                                            <ui:SymbolIcon Symbol="QuestionCircle24" Foreground="#4285F4" Margin="0,0,10,0" />
                                                            <TextBlock Text="{Binding}" VerticalAlignment="Center" TextWrapping="Wrap" />
                                                        </StackPanel>

                                                    </Grid>
                                                </ui:CardAction>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </ui:Card>
                            <ui:Card >
                                <StackPanel >
                                    <local:ChatBubbleList x:Name="ChatBox"/>

                                </StackPanel>

                            </ui:Card>

                        </StackPanel>
                    </ScrollViewer>




                </StackPanel>

            </ui:Card>


            <!-- 底部搜索栏 -->
            <ui:Card Grid.Row="3" Background="#4285F4" Margin="10,0,10,10" Padding="10">
                <ui:TextBox x:Name="SearchBox" PlaceholderText="请输入搜索关键字，回车搜索"  Height="40"
                           Icon="Search24" 
                           VerticalAlignment="Center" 
                           Background="White"
                             AcceptsReturn="True" 
                             TextWrapping="Wrap" 
                            VerticalScrollBarVisibility="Auto"
                            
                            MaxLength="2147483647"
                     
                            PreviewKeyDown="SearchBox_PreviewKeyDown"
                            />
            </ui:Card>
        </Grid>
    </Grid>
</Page>
<!--KeyDown="SearchBox_KeyDown"-->