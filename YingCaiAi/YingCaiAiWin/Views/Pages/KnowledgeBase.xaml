
<Page
    x:Class="YingCaiAiWin.Views.Pages.KnowledgeBase"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:YingCaiAiWin.Views.Pages"
    xmlns:hc="https://handyorg.github.io/handycontrol"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    mc:Ignorable="d"
    Title="知识库管理"
    d:DataContext="{d:DesignInstance local:KnowledgeBase,                     IsDesignTimeCreatable=False}"
    d:DesignHeight="650"
        d:DesignWidth="1000"
    
    Background="{DynamicResource RegionBrush}">

    <Grid>
        <!-- 主内容区 -->
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 搜索和筛选 -->
            <Grid Grid.Row="1" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <hc:SearchBar
                    Grid.Column="0" 
                    hc:InfoElement.Placeholder="请输入关键字"
                    Style="{StaticResource SearchBarExtend}"
                    Margin="0,0,12,0"
                    Width="250"
                    Height="40"
                     Text="{Binding ViewModel.Documents.Filename }"
                    />

                <hc:ComboBox
                    Grid.Column="1"
                    x:Name="StatusFilter"
                    hc:InfoElement.Placeholder="选择文件"
                    Width="170"
                    Margin="0,0,20,0"
                    SelectedIndex="0"
                    >
                    <ComboBoxItem Content="全部" />
                    <ComboBoxItem Content="管理员" />
                </hc:ComboBox>
                
                <Button 
                    Grid.Column="3" 
                    Content="搜索" 
                    Width="100"
                     Height="40"
                    Style="{StaticResource ButtonPrimary}"
                    hc:IconElement.Width="16"
                    Margin="10,0,20,0"
                    
                    Command="{Binding ViewModel.SerachCommand, Mode=OneWay}"
                    CommandParameter="DialogsAndFlyouts" />
                <Button 
                  Grid.Column="4" 
                  Content="上传文件" 
                  Width="100"
                   Height="40"
                  Style="{StaticResource ButtonPrimary}"
                  hc:IconElement.Width="16"
                  Margin="10,0,12,0"
                  Command="{Binding ViewModel.OpenFileCommand}" />

            </Grid>

            <!-- 数据表格 -->
            <hc:Card Grid.Row="2" Margin="0" Padding="0" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}" Effect="{StaticResource EffectShadow1}">
                
                <DataGrid 
                    x:Name="DocsDataGrid"
                    AutoGenerateColumns="False" 
                    IsReadOnly="True"
                    RowHeaderWidth="0"
                    HeadersVisibility="All"
                    CanUserResizeColumns="True"
                    CanUserSortColumns="True"
                    Background="{DynamicResource RegionBrush}"
                    AlternationCount="2"
                    SelectionMode="Single"
                    SelectionUnit="FullRow"
                    RowHeight="48"
                   HorizontalAlignment="Stretch"
                   VerticalAlignment="Stretch"
                   ItemsSource="{Binding ViewModel.Docs, Mode=OneWay}"
                   Height="570"
                    >
                

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60" Visibility="Hidden" />

                        <DataGridTextColumn Header="文件名" Binding="{Binding Filename}" MinWidth="120" >
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                    <Setter Property="FontWeight" Value="SemiBold" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="内容"  Binding="{Binding Content}" Width="*"  >
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                    <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                    <Setter Property="TextWrapping" Value="NoWrap"/>
                                </Style>
                        </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="审核状态"  Binding="{Binding StatusName}" Width="120"  >
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="上传时间" Binding="{Binding CreatedAt, StringFormat=yyyy-MM-dd HH:mm}"  MinWidth="120" >
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                    
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTemplateColumn Header="操作" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button
                                            Content="审核"
                                           
                                            Style="{StaticResource ButtonDashedPrimary}"
                                            hc:IconElement.Width="14"
                                            FontSize="12"
                                            Padding="8,4"
                                            Margin="0,0,8,0"
                                            Command="{Binding ViewModel.ApproveStatusCommand, RelativeSource={RelativeSource AncestorType=local:KnowledgeBase}}"
                                            CommandParameter="{Binding  Id}"/>
                                        <Button
                                            Content="删除"
                                            Style="{StaticResource  ButtonDashedPrimary}"
                                            hc:IconElement.Width="14"
                                            FontSize="12"
                                            Padding="8,4"
                                            Command="{Binding ViewModel.DeleteCommand, RelativeSource={RelativeSource AncestorType=local:KnowledgeBase}}"
                                            CommandParameter="{Binding  Id}"
                                            />
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                    
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                           
                            <!-- 设置间隔高度 -->
                            <Setter Property="Margin" Value="0,0,0,4"/>


                        </Style>
                    </DataGrid.RowStyle>

                    <DataGrid.CellStyle>
                        <Style TargetType="DataGridCell">
                            <Setter Property="Foreground" Value="Black"/>
                            <Setter Property="Background" Value="#f9f9f9 "/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="BorderBrush" Value="#55adcf"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                     
                    </DataGrid.CellStyle>
                 
                </DataGrid>
            </hc:Card>

            <!-- 分页 -->
            <Grid Grid.Row="3" Margin="0,16,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--<TextBlock Grid.Column="0" Text="共  条记录" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" />-->

                <!--<hc:Pagination 
                    Grid.Column="2" 
                    MaxPageCount="2"
                    DataCountPerPage="5"
                    PageIndex="{Binding ViewModel.CurrentPage}"
                    IsJumpEnabled="False"
                    />-->
                <hc:Pagination MaxPageCount="{Binding ViewModel.PageCount}" PageIndex="{Binding ViewModel.CurrentPage}" IsJumpEnabled="True">
                    <hc:Interaction.Triggers>
                        <hc:EventTrigger EventName="PageUpdated">
                            <hc:EventToCommand Command="{Binding ViewModel.PageUpdatedCmd}"  PassEventArgsToCommand="True" />
                        </hc:EventTrigger>
                    </hc:Interaction.Triggers>
                </hc:Pagination>
            </Grid>
        </Grid>


        <hc:Dialog 
            x:Name="UserDialog"
            Width="800"
            MinHeight="600"
            Style="{StaticResource DialogBaseStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>


                <TextBlock Grid.Row="0" Grid.ColumnSpan="2" Text="基本信息" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource PrimaryBrush}" Margin="-277,0,-132,16" />

                <hc:TextBox Grid.Column="0"
                    x:Name="UsernameTextBox"
                    hc:InfoElement.Placeholder="用户名"
                    hc:InfoElement.TitleWidth="0"
                    hc:InfoElement.Necessary="True"
                    Style="{StaticResource TextBoxExtend}"
                    Margin="-305,6,50,84" Grid.Row="1" />

                <hc:TextBox Grid.Column="1"
                    x:Name="FullNameTextBox"
                    hc:InfoElement.Placeholder="姓名"
                    hc:InfoElement.TitleWidth="0"
                    Style="{StaticResource TextBoxExtend}"
                    Margin="4,6,-290,84" Grid.Row="1" />

                <hc:TextBox
                    Grid.Row="1"
                    x:Name="EmailTextBox"
                    hc:InfoElement.Placeholder="邮箱"
                    hc:InfoElement.TitleWidth="0"
                    Style="{StaticResource TextBoxExtend}"
                    Margin="-305,74,59,30" Grid.RowSpan="3" />

                <hc:TextBox
                    Grid.Row="1" Grid.Column="1"
                    x:Name="DepartmentTextBox"
                    hc:InfoElement.Placeholder="部门"
                    hc:InfoElement.TitleWidth="0"
                    Style="{StaticResource TextBoxExtend}"
                    Margin="4,74,-290,21" />

                <hc:TextBox
                    Grid.Row="2"
                    x:Name="PositionTextBox"
                    hc:InfoElement.Placeholder="职位"
                    hc:InfoElement.TitleWidth="0"
                    Style="{StaticResource TextBoxExtend}"
                    Margin="-305,3,59,70" Grid.RowSpan="3" />

                <hc:ProgressButton
                    Grid.Row="4"
                    x:Name="IsActiveToggle"
                    
                    Style="{StaticResource ToggleButtonSwitch}"
                    Margin="52,6,-106,64" Grid.Column="1" />


                <TextBlock Grid.Row="4" Grid.ColumnSpan="2" Text="分配角色" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource PrimaryBrush}" Margin="-305,53,-132,33" />

                <Border Grid.Row="6" Grid.ColumnSpan="2" 
                        BorderBrush="{DynamicResource BorderBrush}" 
                        BorderThickness="1" 
                        CornerRadius="4"
                        Margin="0,0,0,0">
                    <ListBox
                        x:Name="RolesListBox"
                        SelectionMode="Multiple"
                        BorderThickness="0"
                        Background="Transparent" Margin="-321,-31,-279,-55">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <CheckBox
                                    Content="{Binding Name}"
                                    IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                    Tag="{Binding Id}"
                                    Margin="8,8" />
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>


                <StackPanel Grid.Row="8" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                    <Button
                        Content="取消" 
                        Style="{StaticResource ButtonDefault}"
                        Command="{Binding ViewModel.AddUsersCommand, Mode=OneWay}"
  CommandParameter="DialogsAndFlyouts" RenderTransformOrigin="0.57,5.346" />
                    <Button
                        Content="保存" 
                        Style="{StaticResource ButtonPrimary}" 
                        Command="{Binding ViewModel.AddUsersCommand, Mode=OneWay}"
  CommandParameter="DialogsAndFlyouts" />
                </StackPanel>
            </Grid>
        </hc:Dialog>
    </Grid>
</Page>
