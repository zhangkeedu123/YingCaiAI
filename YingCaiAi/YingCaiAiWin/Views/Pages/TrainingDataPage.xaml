
<Page
    x:Class="YingCaiAiWin.Views.Pages.TrainingDataPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:YingCaiAiWin.Views.Pages"
    xmlns:hc="https://handyorg.github.io/handycontrol"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    mc:Ignorable="d"
    Title="话术管理"
    d:DataContext="{d:DesignInstance local:TrainingDataPage,                     IsDesignTimeCreatable=False}"
    d:DesignHeight="650"
        d:DesignWidth="1000"
    
    Background="{DynamicResource RegionBrush}">

    <Grid>
        <!-- 主内容区 -->
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 搜索和筛选 -->
            <Grid Grid.Row="1" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <hc:SearchBar
                    Grid.Column="0" 
                    hc:InfoElement.Placeholder="请输入关键字"
                    Style="{StaticResource SearchBarExtend}"
                    Margin="0,0,12,0"
                    Width="250"
                    Height="40"
                     Text="{Binding ViewModel.TrainingDataSearch.Instruction }"
                    />

                <hc:ComboBox
                    Grid.Column="1"
                    x:Name="StatusFilter"
                    hc:InfoElement.Placeholder="选择状态"
                    Width="170"
                    Margin="0,0,20,0"
                    SelectedIndex="{Binding ViewModel.TrainingDataSearch.Status}"
                    >
                    <ComboBoxItem Content="全部" IsSelected="True" />
                    <ComboBoxItem Content="未审核" />
                    <ComboBoxItem Content="已审核" />
                    <ComboBoxItem Content="已训练" />
                </hc:ComboBox>

                <Button 
                    Grid.Column="3" 
                    Content="搜索" 
                    Width="100"
                     Height="40"
                    Style="{StaticResource ButtonPrimary}"
                    hc:IconElement.Width="16"
                    Margin="10,0,20,0"
                    Command="{Binding ViewModel.SerachCommand, Mode=OneWay}"
                    CommandParameter="DialogsAndFlyouts" />
                <Button 
                  Grid.Column="4" 
                  Content="上传文件" 
                  Width="100"
                   Height="40"
                  Style="{StaticResource ButtonPrimary}"
                  hc:IconElement.Width="16"
                  Margin="10,0,12,0"
                  Command="{Binding ViewModel.OpenFileCommand}" />
                <Button 
             Grid.Column="5" 
             Content="审核" 
             Width="100"
              Height="40"
             Style="{StaticResource ButtonPrimary}"
             hc:IconElement.Width="16"
             Margin="10,0,12,0"
             Command="{Binding ViewModel.ApproveStatusCommand}" />
                <Button 
      Grid.Column="6" 
      Content="删除" 
      Width="100"
       Height="40"
      Style="{StaticResource ButtonPrimary}"
      hc:IconElement.Width="16"
      Margin="10,0,12,0"
    Command="{Binding ViewModel.DeleteCommand}" />

            </Grid>

            <!-- 数据表格 -->
            <hc:Card Grid.Row="2" Margin="0" Padding="0" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}" Effect="{StaticResource EffectShadow1}">

                <DataGrid 
                    x:Name="DocsDataGrid"
                    AutoGenerateColumns="False" 
                    IsReadOnly="True"
                    RowHeaderWidth="0"
                    HeadersVisibility="All"
                    CanUserResizeColumns="True"
                    CanUserSortColumns="True"
                    Background="{DynamicResource RegionBrush}"
                    AlternationCount="2"
                    SelectionMode="Single"
                    SelectionUnit="FullRow"
                    RowHeight="48"
                   HorizontalAlignment="Stretch"
                   VerticalAlignment="Stretch"
                   ItemsSource="{Binding ViewModel.Docs, Mode=OneWay}"
                   Height="620"
                    >


                    <DataGrid.Columns>
                        
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60" Visibility="Hidden" />
                        <!-- ✅ 复选框列：用户选择 -->

                        <DataGridTemplateColumn Width="60">
                            <DataGridTemplateColumn.Header>
                                <CheckBox
                                        IsChecked="{Binding ViewModel.IsAllSelected,RelativeSource={RelativeSource AncestorType=local:TrainingDataPage}}"
                                        Command="{Binding ViewModel.ALLCheckChangedCommand ,RelativeSource={RelativeSource AncestorType=local:TrainingDataPage}}"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"  />
                               
                            </DataGridTemplateColumn.Header>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                Command="{Binding ViewModel.CheckChangedCommand ,RelativeSource={RelativeSource AncestorType=local:TrainingDataPage}}"
                CommandParameter="{Binding Id}"  />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTextColumn Header="系统提示词" Binding="{Binding System}" Width="*" >
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                    <Setter Property="FontWeight" Value="SemiBold" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="问题"  Binding="{Binding Instruction}" Width="*"  >
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                    <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                    <Setter Property="TextWrapping" Value="NoWrap"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="答案"  Binding="{Binding Output}" Width="*"  >
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                    <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                    <Setter Property="TextWrapping" Value="NoWrap"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="审核状态"  Binding="{Binding StatusName}" Width="80"  >
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="上传时间" Binding="{Binding CreatedAt, StringFormat=yyyy-MM-dd HH:mm}"  Width="120" >
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />

                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="训练时间" Binding="{Binding EditAt, StringFormat=yyyy-MM-dd HH:mm}"  Width="120" >
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />

                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <!--<DataGridTemplateColumn Header="操作" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button
                                            Content="审核"
                                           
                                            Style="{StaticResource ButtonDashedPrimary}"
                                            hc:IconElement.Width="14"
                                            FontSize="12"
                                            Padding="8,4"
                                            Margin="0,0,8,0"
                                            Command="{Binding ViewModel.ApproveStatusCommand, RelativeSource={RelativeSource AncestorType=local:TrainingDataPage}}"
                                            CommandParameter="{Binding  Id}"/>
                                        <Button
                                            Content="删除"
                                            Style="{StaticResource  ButtonDashedPrimary}"
                                            hc:IconElement.Width="14"
                                            FontSize="12"
                                            Padding="8,4"
                                            Command="{Binding ViewModel.DeleteCommand, RelativeSource={RelativeSource AncestorType=local:TrainingDataPage}}"
                                            CommandParameter="{Binding  Id}"
                                            />
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>-->
                    </DataGrid.Columns>

                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">

                            <!-- 设置间隔高度 -->
                            <Setter Property="Margin" Value="0,0,0,4"/>


                        </Style>
                    </DataGrid.RowStyle>

                    <DataGrid.CellStyle>
                        <Style TargetType="DataGridCell">
                            <Setter Property="Foreground" Value="Black"/>
                            <Setter Property="Background" Value="#f9f9f9 "/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="BorderBrush" Value="#55adcf"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>

                    </DataGrid.CellStyle>

                </DataGrid>
            </hc:Card>

            <!-- 分页 -->
            <Grid Grid.Row="3" Margin="0,16,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--<TextBlock Grid.Column="0" Text="共  条记录" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" />-->

                <!--<hc:Pagination 
                    Grid.Column="2" 
                    MaxPageCount="2"
                    DataCountPerPage="5"
                    PageIndex="{Binding ViewModel.CurrentPage}"
                    IsJumpEnabled="False"
                    />-->
                <hc:Pagination MaxPageCount="{Binding ViewModel.PageCount}" PageIndex="{Binding ViewModel.CurrentPage}" IsJumpEnabled="True">
                    <hc:Interaction.Triggers>
                        <hc:EventTrigger EventName="PageUpdated">
                            <hc:EventToCommand Command="{Binding ViewModel.PageUpdatedCmd}"  PassEventArgsToCommand="True" />
                        </hc:EventTrigger>
                    </hc:Interaction.Triggers>
                </hc:Pagination>
            </Grid>
        </Grid>


    </Grid>
</Page>
